var Web3 = require('web3');
var web3 = new Web3();
web3.setProvider(new web3.providers.HttpProvider('http://localhost:8102'));

//console.log(web3);
var storage = '';
var profilestorageContract = web3.eth.contract([{"constant":false,"inputs":[{"name":"proFIleNo","type":"uint256"},{"name":"uname","type":"string"},{"name":"udob","type":"int256"},{"name":"uspecialty","type":"bytes32"},{"name":"usocialLink","type":"string"},{"name":"utechnicalLink","type":"string"},{"name":"uprofessionalLink","type":"string"}],"name":"updateProfile","outputs":[{"name":"retVal","type":"bool"}],"type":"function"},{"constant":false,"inputs":[{"name":"cname","type":"string"},{"name":"cdob","type":"int256"},{"name":"cspecialty","type":"bytes32"},{"name":"csocialLink","type":"string"},{"name":"ctechnicalLink","type":"string"},{"name":"cprofessionalLink","type":"string"}],"name":"createProfile","outputs":[{"name":"retVal","type":"uint256"}],"type":"function"},{"constant":true,"inputs":[],"name":"getNo","outputs":[{"name":"retVal","type":"uint256"}],"type":"function"},{"constant":false,"inputs":[{"name":"profileNo","type":"uint256"}],"name":"getProfile","outputs":[{"name":"n","type":"string"},{"name":"d","type":"int256"},{"name":"s","type":"bytes32"},{"name":"sL","type":"string"},{"name":"tL","type":"string"},{"name":"pL","type":"string"}],"type":"function"},{"inputs":[],"type":"constructor"}]);
var profilestorage = profilestorageContract.new(
    {
      from: web3.eth.accounts[0],
      data: '60606040525b60016001600050541015601e5760006001600050819055505b5b6110428061002d6000396000f360606040526000357c01000000000000000000000000000000000000000000000000000000009004806303cbb9ba1461005a5780636e4d62eb146101b45780639f0314fc14610305578063f08f4f641461032857610058565b005b61019e6004808035906020019091908035906020019082018035906020019191908080601f016020809104026020016040519081016040528093929190818152602001838380828437820191505050505050909091908035906020019091908035906020019091908035906020019082018035906020019191908080601f016020809104026020016040519081016040528093929190818152602001838380828437820191505050505050909091908035906020019082018035906020019191908080601f016020809104026020016040519081016040528093929190818152602001838380828437820191505050505050909091908035906020019082018035906020019191908080601f016020809104026020016040519081016040528093929190818152602001838380828437820191505050505050909091905050610c21565b6040518082815260200191505060405180910390f35b6102ef6004808035906020019082018035906020019191908080601f016020809104026020016040519081016040528093929190818152602001838380828437820191505050505050909091908035906020019091908035906020019091908035906020019082018035906020019191908080601f016020809104026020016040519081016040528093929190818152602001838380828437820191505050505050909091908035906020019082018035906020019191908080601f016020809104026020016040519081016040528093929190818152602001838380828437820191505050505050909091908035906020019082018035906020019191908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509090919050506104e9565b6040518082815260200191505060405180910390f35b61031260048050506104d7565b6040518082815260200191505060405180910390f35b61033e600480803590602001909190505061088b565b604051808060200187815260200186815260200180602001806020018060200185810385528b8181518152602001915080519060200190808383829060006004602084601f0104600f02600301f150905090810190601f1680156103b65780820380516001836020036101000a031916815260200191505b508581038452888181518152602001915080519060200190808383829060006004602084601f0104600f02600301f150905090810190601f16801561040f5780820380516001836020036101000a031916815260200191505b508581038352878181518152602001915080519060200190808383829060006004602084601f0104600f02600301f150905090810190601f1680156104685780820380516001836020036101000a031916815260200191505b508581038252868181518152602001915080519060200190808383829060006004602084601f0104600f02600301f150905090810190601f1680156104c15780820380516001836020036101000a031916815260200191505b509a505050505050505050505060405180910390f35b600060016000505490506104e6565b90565b60006000339050600160008181505480929190600101919050555060e0604051908101604052808281526020018981526020018881526020018781526020018681526020018581526020018481526020015060006000506000600160005054815260200190815260200160002060005060008201518160000160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908302179055506020820151816001016000509080519060200190828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106105df57805160ff1916838001178555610610565b82800160010185558215610610579182015b8281111561060f5782518260005055916020019190600101906105f1565b5b50905061063b919061061d565b80821115610637576000818150600090555060010161061d565b5090565b505060408201518160020160005055606082015181600301600050556080820151816004016000509080519060200190828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106106ac57805160ff19168380011785556106dd565b828001600101855582156106dd579182015b828111156106dc5782518260005055916020019190600101906106be565b5b50905061070891906106ea565b8082111561070457600081815060009055506001016106ea565b5090565b505060a0820151816005016000509080519060200190828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f1061075f57805160ff1916838001178555610790565b82800160010185558215610790579182015b8281111561078f578251826000505591602001919060010190610771565b5b5090506107bb919061079d565b808211156107b7576000818150600090555060010161079d565b5090565b505060c0820151816006016000509080519060200190828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f1061081257805160ff1916838001178555610843565b82800160010185558215610843579182015b82811115610842578251826000505591602001919060010190610824565b5b50905061086e9190610850565b8082111561086a5760008181506000905550600101610850565b5090565b50509050506001600050549150610880565b509695505050505050565b602060405190810160405280600081526020015060006000602060405190810160405280600081526020015060206040519081016040528060008152602001506020604051908101604052806000815260200150600060005060008881526020019081526020016000206000506001016000508054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156109925780601f1061096757610100808354040283529160200191610992565b820191906000526020600020905b81548152906001019060200180831161097557829003601f168201915b505050505095508550600060005060008881526020019081526020016000206000506002016000505494508450600060005060008881526020019081526020016000206000506003016000505493508350600060005060008881526020019081526020016000206000506004016000508054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015610a965780601f10610a6b57610100808354040283529160200191610a96565b820191906000526020600020905b815481529060010190602001808311610a7957829003601f168201915b505050505092508250600060005060008881526020019081526020016000206000506005016000508054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015610b525780601f10610b2757610100808354040283529160200191610b52565b820191906000526020600020905b815481529060010190602001808311610b3557829003601f168201915b505050505091508150600060005060008881526020019081526020016000206000506006016000508054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015610c0e5780601f10610be357610100808354040283529160200191610c0e565b820191906000526020600020905b815481529060010190602001808311610bf157829003601f168201915b5050505050905080505b91939550919395565b6000600060006000506000600160005054815260200190815260200160002060005060000160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1690503373ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff16141561102c57876000600050600060016000505481526020019081526020016000206000506001016000509080519060200190828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f10610d0b57805160ff1916838001178555610d3c565b82800160010185558215610d3c579182015b82811115610d3b578251826000505591602001919060010190610d1d565b5b509050610d679190610d49565b80821115610d635760008181506000905550600101610d49565b5090565b505086600060005060006001600050548152602001908152602001600020600050600201600050819055508560006000506000600160005054815260200190815260200160002060005060030160005081905550846000600050600060016000505481526020019081526020016000206000506004016000509080519060200190828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f10610e2957805160ff1916838001178555610e5a565b82800160010185558215610e5a579182015b82811115610e59578251826000505591602001919060010190610e3b565b5b509050610e859190610e67565b80821115610e815760008181506000905550600101610e67565b5090565b5050836000600050600060016000505481526020019081526020016000206000506005016000509080519060200190828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f10610ef557805160ff1916838001178555610f26565b82800160010185558215610f26579182015b82811115610f25578251826000505591602001919060010190610f07565b5b509050610f519190610f33565b80821115610f4d5760008181506000905550600101610f33565b5090565b5050826000600050600060016000505481526020019081526020016000206000506006016000509080519060200190828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f10610fc157805160ff1916838001178555610ff2565b82800160010185558215610ff2579182015b82811115610ff1578251826000505591602001919060010190610fd3565b5b50905061101d9190610fff565b808211156110195760008181506000905550600101610fff565b5090565b50506001915061103656611035565b60009150611036565b5b5097965050505050505056',
      gas: 3000000
    }, function(e, contract){
      console.log(e, contract);
      if (typeof contract.address != 'undefined') {
        console.log('Contract mined! address: ' + contract.address + ' transactionHash: ' + contract.transactionHash);
          storage = contract.address;
        //getProfile();

        var object = {
          uname:'user',udob:65465164,uspecialty:'Dapps',
          usocialLink:'http://twitter.com',utechnicalLink:'http@//github',
          uprofessionalLink:'http://linkedin'};
        createProfileContract(object);
        //console.log(contract.getProfile.call(1));
      }
    })


/**
 * Fetch profile by ID/No returned when created
 * @param no uint
 */
function getProfile(no){

  (typeof(no) == 'undefined'|| no > 0)?no = 0:'' ;

  var psContract = profilestorageContract.at(profilestorage);

  var profile = psContract.getProfile.call(no);

  console.log(profile);
}

/**
 * Create Profile from Object of arguments
 * @param object Oject containing arguments required to create contract.
 */
function createProfileContract(object){
  var newContract = profilestorageContract.new.getData(
      object.uname,
      object.udob,
      object.uspecialty,
      object.usocialLink,
      object.utechnicalLink,
      object.uprofessionalLink
        );

  storage = newContract;

  console.log(newContract);
//Log address of new contract
}


function updateProfileContract(object){
  var newContract = profilestorageContract.new(
      object.uname,
      object.udob,
      object.uspecialty,
      object.usocialLink,
      object.utechnicalLink,
      object.uprofessionalLink
  );

  //var txn =

  //storage = newContract;

  console.log(newContract);
//Log address of new contract
}
